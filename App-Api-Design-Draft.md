# Api协议设计

### 一、基本要求

- api良好的可扩展性
- 请求，响应状态的完备
- 一定的安全性
- 较好的平台一致性
- 较小的流量消耗

### 二、准则

遵循RESTful设计原则，所有API的单元为资源，以GET，PUT，POST，DELETE来进行增删改查的操作
如下：

```
GET api/account
PUT api/account
POST api/account
DELETE api/account
```

### 三、实现

1、基本格式
api返回给客户端的逻辑数据统一为json, 格式如下：
request

```
  api: "api-path”
  params: {...}
```

可能的客户端实现如下:

```
Client.post(“path/to/api”, {data: data}, callback);
```

response

```
{
  code: 0, // status code
  msg: ''
  data: {...}
} 
```

2、数据编码，压缩，加密

此处的技术选型，以及相应的算法选择，大家可以根据自己已有的知识进行自行判定
  
3、状态码

所有请求都需要返回相应的状态码，基本分配如下：

- 0 一切正常
- <0 客户端错误
- 1~9 协议错误
- \>=10 业务错误

**客户端服务端错误**

1. 未知错误    
2. api 请求超时    
3. api 格式不正确 （对应http status 400）
4. api 请求的内容不存在（对应http status 404）
5. 服务器内部错误 （对应http status 500）
6. 服务器目前无法使用（由于超载或停机维护，对应http status 503）
7. 服务器获取的数据无法解码 
8. 数据错误
9. 请求方式错误

**协议错误**

1. 无法找到api名字对应的处理类
2. api业务代码抛出了未捕获的异常

**业务错误**

10~19 账户相关

- 10 账号已存在
- 11 账号不存在
- 12 昵称被使用
- 13 两次密码不一致
- 14 邮箱格式不正确
- 15 账号或密码错误
